const { GoogleGenerativeAI } = require('@google/generative-ai');
const fs = require('fs');
const path = require('path');

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

// å±¥æ­´ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹
const HISTORY_FILE = path.join(__dirname, '../../data/word_history.json');

/**
 * éå»ã«ä½¿ç”¨ã—ãŸãƒ¯ãƒ¼ãƒ‰ã®å±¥æ­´ã‚’å–å¾—
 * @returns {string[]}
 */
function getWordHistory() {
    try {
        // ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
        const dataDir = path.dirname(HISTORY_FILE);
        if (!fs.existsSync(dataDir)) {
            fs.mkdirSync(dataDir, { recursive: true });
        }

        if (fs.existsSync(HISTORY_FILE)) {
            const data = fs.readFileSync(HISTORY_FILE, 'utf8');
            return JSON.parse(data);
        }
    } catch (error) {
        console.error('å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
    }
    return [];
}

/**
 * æ–°ã—ã„ãƒ¯ãƒ¼ãƒ‰ã‚’å±¥æ­´ã«è¿½åŠ ï¼ˆæœ€å¤§50ä»¶ä¿æŒï¼‰
 * @param {string[]} newWords 
 */
function addToWordHistory(newWords) {
    try {
        let history = getWordHistory();

        // æ–°ã—ã„ãƒ¯ãƒ¼ãƒ‰ã‚’è¿½åŠ 
        history = [...newWords, ...history];

        // 50ä»¶ã‚’è¶…ãˆãŸã‚‰å¤ã„ã‚‚ã®ã‚’å‰Šé™¤
        if (history.length > 50) {
            history = history.slice(0, 50);
        }

        // ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ä½œæˆ
        const dataDir = path.dirname(HISTORY_FILE);
        if (!fs.existsSync(dataDir)) {
            fs.mkdirSync(dataDir, { recursive: true });
        }

        fs.writeFileSync(HISTORY_FILE, JSON.stringify(history, null, 2));
    } catch (error) {
        console.error('å±¥æ­´ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
    }
}

/**
 * ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã®ãŠé¡Œã‚’ç”Ÿæˆã™ã‚‹
 * @returns {Promise<{village: string, wolf: string, fox: string}>}
 */
async function generateTopics() {
    const model = genAI.getGenerativeModel({ model: 'gemini-2.5-flash' });

    // éå»ã®å±¥æ­´ã‚’å–å¾—
    const wordHistory = getWordHistory();
    const historyList = wordHistory.length > 0
        ? `\n\nã€ä½¿ç”¨ç¦æ­¢ãƒ¯ãƒ¼ãƒ‰ - éå»ã«ä½¿ç”¨æ¸ˆã¿ã€‘\n${wordHistory.join('ã€')}`
        : '';

    // ãƒ©ãƒ³ãƒ€ãƒ ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠï¼ˆ50%ãšã¤ï¼‰
    const isPatternA = Math.random() < 0.5;

    let prompt;

    if (isPatternA) {
        // ãƒ‘ã‚¿ãƒ¼ãƒ³A: æ‘/ç‹¼ãŒå¤§äººå‘ã‘ã€ç‹ãŒä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰
        prompt = `ã‚ãªãŸã¯ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã‚²ãƒ¼ãƒ ã®ãŠé¡Œã‚’ç”Ÿæˆã™ã‚‹AIã§ã™ã€‚
ä»Šå›ã¯ã€ãƒ‘ã‚¿ãƒ¼ãƒ³Aã€‘ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ãƒ‘ã‚¿ãƒ¼ãƒ³A - æ‘äººã¨ç‹¼ãŒå¤§äººå‘ã‘ã€ç‹ãŒä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ã€‘
- village ã¨ wolf ã¯åŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã®ä¼¼ãŸã€Œã‚»ã‚¯ã‚·ãƒ¼ãªå¤§äººå‘ã‘(R-18)ã€ã®è¨€è‘‰ã«ã™ã‚‹
- fox ã¯å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ã®ã€Œä¸€èˆ¬çš„ãªã€è¨€è‘‰ã«ã™ã‚‹

ã€ã‚»ã‚¯ã‚·ãƒ¼ãƒ†ãƒ¼ãƒã®å‚è€ƒã‚«ãƒ†ã‚´ãƒªï¼ˆã“ã‚Œã‚‰ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ï¼‰ã€‘
- ä¸‹ç€ãƒ»ãƒ©ãƒ³ã‚¸ã‚§ãƒªãƒ¼ãƒ»å‹è² æœ
- å¤§äººã®é“å…·ãƒ»ãŠã‚‚ã¡ã‚ƒï¼ˆãƒã‚¤ãƒ–ãƒ»ãƒ­ãƒ¼ã‚¿ãƒ¼ãƒ»é›»ãƒãªã©ï¼‰
- å¤œã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãƒ»ä½“ä½ï¼ˆé¨ä¹—ä½ãƒ»ãƒãƒƒã‚¯ãƒ»å¯¾é¢åº§ä½ãªã©ï¼‰
- èˆˆå¥®ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å ´æ‰€
- èº«ä½“ã®éƒ¨ä½ï¼ˆèƒ¸ãƒ»å°»ãªã©ï¼‰ãƒ»ãƒ•ã‚§ãƒï¼ˆåŒ‚ã„ãªã©ï¼‰
- ã‚³ã‚¹ãƒ—ãƒ¬ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤
- Sã£æ°—ãƒ»Mã£æ°—ãƒ»æ”»ã‚ã¨å—ã‘ãƒ»ç—´å¥³
- ã‚®ãƒªã‚®ãƒªã®ãƒ©ã‚¤ãƒ³ï¼ˆéœ²å‡ºãƒ»ã‚¹ãƒªãƒ«ï¼‰
- æµ®æ°—ãƒ»ä¸å€«ãƒ»ä¿®ç¾…å ´ãƒ»å¯å–ã‚‰ã‚Œï¼ˆNTRï¼‰
- æŒ¿å…¥ã™ã‚‹é“å…·ï¼ˆãƒã‚¤ãƒ–ãƒ»ãƒ‡ã‚£ãƒ«ãƒ‰ãƒ»å¼µå½¢ï¼‰
- è²¬ã‚ã‚‹é“å…·ï¼ˆãƒ­ãƒ¼ã‚¿ãƒ¼ãƒ»é›»ãƒãƒ»ã‚¯ãƒªãƒƒãƒ—ãƒ»é­ãƒ»è‹ç‡­ãƒ»æ‰‹éŒ ï¼‰
- SMãƒ»æ‹˜æŸãƒ»è²¬ã‚è‹¦
- å£ã‚„èˆŒã‚’ä½¿ã†è¡Œç‚ºï¼ˆãƒ•ã‚§ãƒ©ãƒ»ã‚¯ãƒ³ãƒ‹ãƒ»69ï¼‰
- æ±ãƒ»åˆ†æ³Œæ¶²ï¼ˆç²¾æ¶²ãƒ»æ½®ãƒ»æ„›æ¶²ãƒ»å”¾æ¶²ï¼‰
- ã‚¢ãƒŠãƒ«ãƒ»æµ£è…¸ãƒ»æ”¾å°¿

ã€çµ¶å¯¾ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«ã€‘
1. villageã¨wolfã¯åŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã®ä¼¼ãŸè¨€è‘‰ã«ã™ã‚‹ï¼ˆä¾‹ï¼šãƒã‚¤ãƒ–ã¨ãƒ­ãƒ¼ã‚¿ãƒ¼ã€ã©ã¡ã‚‰ã‚‚æ€§å…·ï¼‰
2. foxã¯å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ã§ã€ã‹ã™ã‚Šã‚‚ã—ãªã„ä¸€èˆ¬çš„ãªè¨€è‘‰ã«ã™ã‚‹ï¼ˆä¾‹ï¼šåŸå­åŠ›ç™ºé›»æ‰€ï¼‰
3. 3ã¤å…¨ã¦ãŒåŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆã“ã‚ŒãŒæœ€é‡è¦ï¼‰
4. ã€é‡è¦ã€‘villageã¨wolfã¯ã€Œæ„å‘³ãŒé‡è¤‡ã—ãªã„ã€ã“ã¨ï¼
   - NGä¾‹: ã€Œã‚³ãƒ³ãƒ‰ãƒ¼ãƒ ã€ã¨ã€Œé¿å¦Šå…·ã€ï¼ˆã‚³ãƒ³ãƒ‰ãƒ¼ãƒ ã¯é¿å¦Šå…·ã®ä¸€ç¨®ãªã®ã§NGï¼‰
   - NGä¾‹: ã€Œãƒªãƒ³ã‚´ã€ã¨ã€Œæœç‰©ã€ï¼ˆãƒªãƒ³ã‚´ã¯æœç‰©ã®ä¸€ç¨®ãªã®ã§NGï¼‰
   - OKä¾‹: ã€Œãƒã‚¤ãƒ–ã€ã¨ã€Œãƒ­ãƒ¼ã‚¿ãƒ¼ã€ï¼ˆåŒã˜ã‚«ãƒ†ã‚´ãƒªã ãŒåˆ¥ç‰©ãªã®ã§OKï¼‰

ã€è‰¯ã„ä¾‹ã€‘
village: "ãƒã‚¤ãƒ–"ï¼ˆå¤§äººå‘ã‘ï¼‰
wolf: "ãƒ­ãƒ¼ã‚¿ãƒ¼"ï¼ˆå¤§äººå‘ã‘ï¼‰
fox: "åŸå­åŠ›ç™ºé›»æ‰€"ï¼ˆä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ã€å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ï¼‰${historyList}

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã¯ä¸è¦ã§ã™ã€‚
{"village": "xxx", "wolf": "xxx", "fox": "xxx"}`;
    } else {
        // ãƒ‘ã‚¿ãƒ¼ãƒ³B: ç‹ãŒå¤§äººå‘ã‘ã€æ‘/ç‹¼ãŒä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰
        prompt = `ã‚ãªãŸã¯ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã‚²ãƒ¼ãƒ ã®ãŠé¡Œã‚’ç”Ÿæˆã™ã‚‹AIã§ã™ã€‚
ä»Šå›ã¯ã€ãƒ‘ã‚¿ãƒ¼ãƒ³Bã€‘ã§ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ãƒ‘ã‚¿ãƒ¼ãƒ³B - ç‹ãŒå¤§äººå‘ã‘ã€æ‘äººã¨ç‹¼ãŒä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ã€‘
- village ã¨ wolf ã¯åŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã®ä¼¼ãŸã€Œä¸€èˆ¬çš„ãªã€è¨€è‘‰ã«ã™ã‚‹
- fox ã¯å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ã®ã€Œã‚»ã‚¯ã‚·ãƒ¼ãªå¤§äººå‘ã‘(R-18)ã€ã®è¨€è‘‰ã«ã™ã‚‹

ã€ã‚»ã‚¯ã‚·ãƒ¼ãƒ†ãƒ¼ãƒã®å‚è€ƒã‚«ãƒ†ã‚´ãƒªï¼ˆfoxã¯ã“ã‚Œã‚‰ã‹ã‚‰é¸ã‚“ã§ãã ã•ã„ï¼‰ã€‘
- ä¸‹ç€ãƒ»ãƒ©ãƒ³ã‚¸ã‚§ãƒªãƒ¼ãƒ»å‹è² æœ
- å¤§äººã®é“å…·ãƒ»ãŠã‚‚ã¡ã‚ƒï¼ˆãƒã‚¤ãƒ–ãƒ»ãƒ­ãƒ¼ã‚¿ãƒ¼ãƒ»é›»ãƒãªã©ï¼‰
- å¤œã®ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ãƒ»ä½“ä½ï¼ˆé¨ä¹—ä½ãƒ»ãƒãƒƒã‚¯ãƒ»å¯¾é¢åº§ä½ãªã©ï¼‰
- èˆˆå¥®ã™ã‚‹ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»å ´æ‰€
- èº«ä½“ã®éƒ¨ä½ï¼ˆèƒ¸ãƒ»å°»ãªã©ï¼‰ãƒ»ãƒ•ã‚§ãƒï¼ˆåŒ‚ã„ãªã©ï¼‰
- ã‚³ã‚¹ãƒ—ãƒ¬ãƒ»ãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ã‚¤
- Sã£æ°—ãƒ»Mã£æ°—ãƒ»æ”»ã‚ã¨å—ã‘ãƒ»ç—´å¥³
- ã‚®ãƒªã‚®ãƒªã®ãƒ©ã‚¤ãƒ³ï¼ˆéœ²å‡ºãƒ»ã‚¹ãƒªãƒ«ï¼‰
- æµ®æ°—ãƒ»ä¸å€«ãƒ»ä¿®ç¾…å ´ãƒ»å¯å–ã‚‰ã‚Œï¼ˆNTRï¼‰
- æŒ¿å…¥ã™ã‚‹é“å…·ï¼ˆãƒã‚¤ãƒ–ãƒ»ãƒ‡ã‚£ãƒ«ãƒ‰ãƒ»å¼µå½¢ï¼‰
- è²¬ã‚ã‚‹é“å…·ï¼ˆãƒ­ãƒ¼ã‚¿ãƒ¼ãƒ»é›»ãƒãƒ»ã‚¯ãƒªãƒƒãƒ—ãƒ»é­ãƒ»è‹ç‡­ãƒ»æ‰‹éŒ ï¼‰
- SMãƒ»æ‹˜æŸãƒ»è²¬ã‚è‹¦
- å£ã‚„èˆŒã‚’ä½¿ã†è¡Œç‚ºï¼ˆãƒ•ã‚§ãƒ©ãƒ»ã‚¯ãƒ³ãƒ‹ãƒ»69ï¼‰
- æ±ãƒ»åˆ†æ³Œæ¶²ï¼ˆç²¾æ¶²ãƒ»æ½®ãƒ»æ„›æ¶²ãƒ»å”¾æ¶²ï¼‰
- ã‚¢ãƒŠãƒ«ãƒ»æµ£è…¸ãƒ»æ”¾å°¿

ã€çµ¶å¯¾ã«å®ˆã‚‹ã¹ããƒ«ãƒ¼ãƒ«ã€‘
1. villageã¨wolfã¯åŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã®ä¼¼ãŸä¸€èˆ¬çš„ãªè¨€è‘‰ã«ã™ã‚‹ï¼ˆä¾‹ï¼šã‚³ãƒ¼ãƒ’ãƒ¼ã¨ç´…èŒ¶ã€ã©ã¡ã‚‰ã‚‚é£²ã¿ç‰©ï¼‰
2. foxã¯å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ã§ã€ã‹ã™ã‚Šã‚‚ã—ãªã„å¤§äººå‘ã‘ã®è¨€è‘‰ã«ã™ã‚‹ï¼ˆä¾‹ï¼šãƒã‚¤ãƒ–ï¼‰
3. 3ã¤å…¨ã¦ãŒåŒã˜ã‚¸ãƒ£ãƒ³ãƒ«ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹ï¼ˆã“ã‚ŒãŒæœ€é‡è¦ï¼‰
4. ã€é‡è¦ã€‘villageã¨wolfã¯ã€Œæ„å‘³ãŒé‡è¤‡ã—ãªã„ã€ã“ã¨ï¼
   - NGä¾‹: ã€Œãƒªãƒ³ã‚´ã€ã¨ã€Œæœç‰©ã€ï¼ˆãƒªãƒ³ã‚´ã¯æœç‰©ã®ä¸€ç¨®ãªã®ã§NGï¼‰
   - NGä¾‹: ã€ŒçŠ¬ã€ã¨ã€Œå‹•ç‰©ã€ï¼ˆçŠ¬ã¯å‹•ç‰©ã®ä¸€ç¨®ãªã®ã§NGï¼‰
   - OKä¾‹: ã€Œã‚³ãƒ¼ãƒ’ãƒ¼ã€ã¨ã€Œç´…èŒ¶ã€ï¼ˆåŒã˜ã‚«ãƒ†ã‚´ãƒªã ãŒåˆ¥ç‰©ãªã®ã§OKï¼‰

ã€è‰¯ã„ä¾‹ã€‘
village: "ã‚³ãƒ¼ãƒ’ãƒ¼"ï¼ˆä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ï¼‰
wolf: "ç´…èŒ¶"ï¼ˆä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ï¼‰
fox: "ãƒã‚¤ãƒ–"ï¼ˆå¤§äººå‘ã‘ã€å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ï¼‰

ã€ä»–ã®è‰¯ã„ä¾‹ã€‘
village: "æ±äº¬ã‚¿ãƒ¯ãƒ¼"ï¼ˆä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ï¼‰
wolf: "ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼"ï¼ˆä¸€èˆ¬ãƒ¯ãƒ¼ãƒ‰ï¼‰
fox: "ãƒ­ãƒ¼ã‚¿ãƒ¼"ï¼ˆå¤§äººå‘ã‘ã€å…¨ãé•ã†ã‚¸ãƒ£ãƒ³ãƒ«ï¼‰${historyList}

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜ã¯ä¸è¦ã§ã™ã€‚
{"village": "xxx", "wolf": "xxx", "fox": "xxx"}`;
    }

    try {
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text().trim();

        // JSONéƒ¨åˆ†ã‚’æŠ½å‡º
        const jsonMatch = text.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
            const topics = JSON.parse(jsonMatch[0]);

            // æ–°ã—ã„ãƒ¯ãƒ¼ãƒ‰ã‚’å±¥æ­´ã«è¿½åŠ 
            addToWordHistory([topics.village, topics.wolf, topics.fox]);

            console.log(`ğŸ¯ ãŠé¡Œç”Ÿæˆ (${isPatternA ? 'ãƒ‘ã‚¿ãƒ¼ãƒ³A: æ‘ç‹¼=å¤§äºº, ç‹=ä¸€èˆ¬' : 'ãƒ‘ã‚¿ãƒ¼ãƒ³B: æ‘ç‹¼=ä¸€èˆ¬, ç‹=å¤§äºº'}):`, topics);

            return topics;
        }
        throw new Error('Invalid response format');
    } catch (error) {
        console.error('ãŠé¡Œç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¿œã˜ã¦ï¼‰
        if (isPatternA) {
            return {
                village: "ãƒã‚¤ãƒ–",
                wolf: "ãƒ­ãƒ¼ã‚¿ãƒ¼",
                fox: "åŸå­åŠ›ç™ºé›»æ‰€"
            };
        } else {
            return {
                village: "ã‚³ãƒ¼ãƒ’ãƒ¼",
                wolf: "ç´…èŒ¶",
                fox: "ãƒã‚¤ãƒ–"
            };
        }
    }
}

/**
 * ãŠé¡Œã«å¯¾ã™ã‚‹è³ªå•æ¡ˆã‚’5å€‹ç”Ÿæˆã™ã‚‹
 * @param {string} topic ãŠé¡Œ
 * @returns {Promise<string[]>}
 */
async function generateQuestions(topic) {
    const model = genAI.getGenerativeModel({ model: 'gemini-2.5-flash' });

    const prompt = `ãƒ¯ãƒ¼ãƒ‰ã‚¦ãƒ«ãƒ•ã‚²ãƒ¼ãƒ ã§ã€Œ${topic}ã€ã¨ã„ã†ãŠé¡ŒãŒå‡ºã¦ã„ã¾ã™ã€‚
ã“ã®ãŠé¡Œã«ã¤ã„ã¦ä»–ã®å‚åŠ è€…ã«è³ªå•ã™ã‚‹å†…å®¹ã‚’5å€‹ã€ç°¡æ½”ã«ææ¡ˆã—ã¦ãã ã•ã„ã€‚
è³ªå•ã¯ç›¸æ‰‹ãŒæ‘äººã‹ç‹¼ã‹ã‚’è¦‹æ¥µã‚ã‚‹ã®ã«å½¹ç«‹ã¤ã‚‚ã®ã«ã—ã¦ãã ã•ã„ã€‚

ã€å‡ºåŠ›å½¢å¼ã€‘
ä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚
["è³ªå•1", "è³ªå•2", "è³ªå•3", "è³ªå•4", "è³ªå•5"]`;

    try {
        const result = await model.generateContent(prompt);
        const response = await result.response;
        const text = response.text().trim();

        const jsonMatch = text.match(/\[[\s\S]*\]/);
        if (jsonMatch) {
            return JSON.parse(jsonMatch[0]);
        }
        throw new Error('Invalid response format');
    } catch (error) {
        console.error('è³ªå•ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
        return [
            "ãã‚Œã‚’æœ€å¾Œã«ä½¿ã£ãŸã®ã¯ã„ã¤ã§ã™ã‹ï¼Ÿ",
            "ãã‚Œã®è‰²ã¯ä½•è‰²ã§ã™ã‹ï¼Ÿ",
            "ãã‚Œã¯ã©ã“ã§è²·ãˆã¾ã™ã‹ï¼Ÿ",
            "ãã‚Œã‚’ä½¿ã†ã¨ãã®æ°—æŒã¡ã¯ï¼Ÿ",
            "ãã‚Œã®å€¤æ®µã¯ã©ã‚Œãã‚‰ã„ã§ã™ã‹ï¼Ÿ"
        ];
    }
}

module.exports = { generateTopics, generateQuestions };
